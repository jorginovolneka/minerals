<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent치콏 Mineralogick칠 Sb칤rky</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        h1 { margin-bottom: 20px; color: #343a40; }
        
        /* Styl kontejneru pro ID a ikonku */
        .id-cell {
            display: flex;
            align-items: center;
            gap: 10px; /* Mezera mezi 캜칤slem a ikonkou */
        }

        /* Ikonka fotoapar치tu */
        .photo-icon {
            text-decoration: none;
            font-size: 1.2em;
            cursor: pointer;
            position: relative;
            display: none; /* Ve v칳choz칤m stavu skryt칠, JS to odkryje, pokud fotka existuje */
        }

        /* N치hled obr치zku (po najet칤 my코i) */
        .img-preview-box {
            display: none;
            position: absolute;
            z-index: 1000;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 180px; /* 먞솬뗢a n치hledu */
        }
        
        .img-preview-box img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Zobrazen칤 n치hledu p콏i hoveru */
        .photo-icon:hover .img-preview-box {
            display: block;
        }

        /* Na mobilu hover vypneme, aby nep콏ek치쬰l */
        @media (max-width: 768px) {
            .img-preview-box { display: none !important; }
        }
    </style>
</head>
<body>

    <div class="container-fluid">
        <h1>游뿯 Mineralogick치 sb칤rka</h1>
        <div id="loading" class="alert alert-info">Na캜칤t치m data sb칤rky...</div>
        
        <div class="table-responsive">
            <table id="inventoryTable" class="table table-striped table-hover" style="width:100%">
            </table>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <script>
        $(document).ready(function() {
            // NASTAVEN칈:
            const csvFile = 'data.csv'; 
            // P콏esn칳 n치zev sloupce v CSV, kde je invent치rn칤 캜칤slo (nap콏. "inventarnicislo" nebo "Inv. 캛칤slo")
            const idColumnName = 'inventarnicislo'; 
            // P콏칤pona obr치zk콢 (d콢le쬴t칠 pro mal치/velk치 p칤smena, na GitHubu je rozd칤l .jpg a .JPG!)
            const imgExtension = '.jpg';

            Papa.parse(csvFile, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    let data = results.data;
                    
                    if (data.length === 0) {
                        $('#loading').text('Chyba: CSV soubor je pr치zdn칳.');
                        return;
                    }

                    // Z칤sk치n칤 n치zv콢 sloupc콢
                    let columns = Object.keys(data[0]).map(col => {
                        return { title: col, data: col };
                    });

                    // Inicializace tabulky
                    $('#inventoryTable').DataTable({
                        data: data,
                        columns: columns,
                        language: { url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/cs.json' },
                        columnDefs: [
                            {
                                // Najdeme sloupec s ID a uprav칤me jeho obsah
                                targets: Object.keys(data[0]).indexOf(idColumnName),
                                render: function(data, type, row) {
                                    if (!data) return '';

                                    // Cesta k obr치zku: img/1.jpg
                                    let imgPath = 'img/' + data + imgExtension;

                                    // Trik: Vlo쮂셠e skryt칳 <img> (tester), kter칳 zkus칤 na캜칤st obr치zek.
                                    // Pokud se na캜te (onload), zobraz칤 odkaz s ikonkou (photo-icon).
                                    // Pokud sel쬰 (onerror), ikonka z콢stane skryt치.
                                    return `
                                        <div class="id-cell">
                                            <span>${data}</span>
                                            
                                            <span style="display:none;">
                                                <img src="${imgPath}" 
                                                     onload="this.parentNode.nextElementSibling.style.display='inline-block'"
                                                     onerror="this.remove()"> 
                                            </span>

                                            <a href="${imgPath}" target="_blank" class="photo-icon" title="Zobrazit foto">
                                                游닝
                                                <div class="img-preview-box">
                                                    <img src="${imgPath}" loading="lazy">
                                                </div>
                                            </a>
                                        </div>
                                    `;
                                }
                            }
                        ]
                    });

                    $('#loading').hide();
                },
                error: function(err) {
                    $('#loading').addClass('alert-danger').text('Chyba: ' + err);
                }
            });
        });
    </script>
</body>
</html>